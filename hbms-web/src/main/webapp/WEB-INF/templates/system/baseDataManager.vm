<link rel="stylesheet" href="/resources/ztree/zTreeStyle.css" type="text/css">
<script type="text/javascript" src="/resources/ztree/jquery.ztree.all.js"></script>

<div class="row">
  <div class="col-sm-1">
    <a href="#commonBaseData" class="list-group-item" style="background-color: #3b98d6;border: #ddd solid 1px" data-toggle="collapse">公共数据</a>
    <div id="commonBaseData" class="collapse in">
      <div class="list-group" style="margin: 0px">
        <a href="#" class="list-group-item" onclick="loadData('SEX')">性别</a>
        <a href="#" class="list-group-item" onclick="loadData('MARITAL')">婚姻状况</a>
        <a href="#" class="list-group-item" onclick="loadData('DEGREE')">学历</a>
        <a href="#" class="list-group-item" onclick="loadData('INDUSTRY')">行业</a>
      </div>
    </div>

    <a href="#candidateBaseData" class="list-group-item" style="background-color: #3b98d6;border: #ddd solid 1px" data-toggle="collapse">人才相关</a>
    <div id="candidateBaseData" class="collapse in">
      <div class="list-group" style="margin: 0px">
          #foreach($authority in $authorities)
            <a href="$authority.uri" class="list-group-item">$authority.name</a>
          #end
      </div>
    </div>

    <a href="#companyBaseData" class="list-group-item" style="background-color: #ddd" data-toggle="collapse">公司相关</a>
    <div id="companyBaseData" class="collapse in">
      <div class="list-group" style="margin: 0px">
          #foreach($authority in $authorities)
            <a href="$authority.uri" class="list-group-item">$authority.name</a>
          #end
      </div>
    </div>

    <a href="#contactBaseData" class="list-group-item" style="background-color: #ddd" data-toggle="collapse">联系人相关</a>
    <div id="contactBaseData" class="collapse in">
      <div class="list-group" style="margin: 0px">
          #foreach($authority in $authorities)
            <a href="$authority.uri" class="list-group-item">$authority.name</a>
          #end
      </div>
    </div>

    <a href="#projectBaseData" class="list-group-item" style="background-color: #ddd" data-toggle="collapse">项目相关</a>
    <div id="projectBaseData" class="collapse in">
      <div class="list-group" style="margin: 0px">
          #foreach($authority in $authorities)
            <a href="$authority.uri" class="list-group-item">$authority.name</a>
          #end
      </div>
    </div>
  </div>
  <div class="col-sm-10">
    <div class="row">
      <div class="col-xs-12">
        <!-- PAGE CONTENT BEGINS -->
        <div class="row">
          <div id="dataContent" class="col-sm-12">

          </div>
        </div>
      </div>
    </div>
  </div>

</div>

<script type="text/javascript">
  function loadData(code) {
    $.ajax({
      type: "POST",
      url: "/baseData/findByCode.do",
      data: {code:code},
      dataType: "json",
      timeout: 3000,
      success: function(data, textStatus, jqXHR){
        $("#dataContent").empty();
        $("#dataContent").html("<div class='dd'><ol class='dd-list'>" + createList([data]) + "</ol></div>");
        $('.dd').nestable();
        $('.dd-handle a').on('mousedown', function(e){
          e.stopPropagation();
        });
      },
      error: function(XMLHttpRequest, textStatus, errorThrown) {
        var tipHtml = "<h5 class='red'><i class=\"icon-warning-sign red bigger-130\"></i>加载失败</h5>";
        bootbox.dialog({
          message: tipHtml,
          buttons: {
            "danger" : {
              "label" : "关闭",
              "className" : "btn-sm btn-danger"
            }
          }
        });
      }
    });
  }

  function createList(data) {
    var html = "";
    $(data).each(function (index, item) {
      html += "<li class='dd-item' data-id='" + item.id + "'>";
      html += "<div class='dd-handle'>" + item.label
      html += "<div class='pull-right action-buttons'>";
      html += "<a class='blue' href='#' onclick='addItem(this)'><i class='ace-icon fa fa-plus bigger-130'></i></a>";
      //不能删除顶级节点
      if (item.parentId && item.parentId != null) {
        html += "<a class='blue' href='#'><i class='ace-icon fa fa-remove bigger-130'></i></a>";
      }
      html += "</div>";
      html += "</div>";
      if (item.children && item.children.length > 0) {
        html += "<ol class='dd-list'>" + createList(item.children) + "</ol>";
      }
      html += "</li>";
    });
    return html;
  }
  
  function addItem(obj) {
    var item = "<li class='dd-item' data-id='" + $(obj).parent().parent().parent().data("id") + "1'>";
    item += "<div class='dd-handle'>男";
    item += "<div class='pull-right action-buttons'>";
    item += "<a class='blue' href='#' onclick='addItem(this)'><i class='ace-icon fa fa-plus bigger-130'></i></a>";
    item += "<a class='blue' href='#'><i class='ace-icon fa fa-remove bigger-130'></i></a>";
    item += "</div>";
    item += "</div>";
    item += "</li>";
    if ($(obj).parent().parent().parent().find("ol").length == 1) {
      $(obj).parent().parent().parent().find("ol").append(item);
    } else {
      $(obj).parent().parent().parent().append("<ol class='dd-list'>" + item + "</ol>");
    }
    $("#dataContent button").remove();
    var tempHtml = $("#dataContent").html();
    $("#dataContent").empty();
    $("#dataContent").html(tempHtml);
    $('.dd').nestable();
    $('.dd-handle a').on('mousedown', function(e){
      e.stopPropagation();
    });
  }


</script>
